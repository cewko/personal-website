!function(){"use strict";let e=null,t=!0,n=!1;const o=localStorage.getItem("hangout-sound-enabled");null!==o&&(t="true"===o),document.addEventListener("click",(()=>{n=!0,e&&"suspended"===e.state&&e.resume()}),{once:!0});const s=document.getElementById("chat-messages"),i=document.getElementById("message-input"),c=document.getElementById("nickname-input"),a=document.getElementById("send-button"),r=document.querySelector(".online-count"),l=document.getElementById("chat-errors");const h=new class{constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=10,this.reconnectDelay=1e3,this.maxReconnectDelay=3e4,this.reconnectTimeout=null,this.heartbeatInterval=null,this.isInitialLoad=!0,this.isIntentionallyClosed=!1,this.connectionTimeout=null}connect(){if(this.connectionTimeout&&clearTimeout(this.connectionTimeout),!this.ws||this.ws.readyState!==WebSocket.CONNECTING&&this.ws.readyState!==WebSocket.OPEN)try{const e=`${"https:"===location.protocol?"wss:":"ws:"}//${location.host}/ws/hangout/`;this.ws=new WebSocket(e),this.connectionTimeout=setTimeout((()=>{this.ws.readyState===WebSocket.CONNECTING&&(this.ws.close(),this.handleReconnect())}),1e4),this.ws.onopen=()=>this.onOpen(),this.ws.onmessage=e=>this.onMessage(e),this.ws.onerror=()=>{},this.ws.onclose=e=>this.onClose(e)}catch(e){this.handleReconnect()}}onOpen(){this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=null),this.reconnectAttempts=0,this.reconnectDelay=1e3,l.innerHTML="",l.style.display="none",this.startHeartbeat(),this.isInitialLoad=!0}onMessage(o){try{const i=JSON.parse(o.data);"message"===i.type?function(o){const i=document.createElement("div");i.className="chat-message";const c=document.createElement("div");c.className="message-time",c.textContent=`[ ${function(e){const t=new Date(e),n=new Date,o=new Date(n.getFullYear(),n.getMonth(),n.getDate()),s=new Date(o);s.setDate(s.getDate()-1);const i=new Date(t.getFullYear(),t.getMonth(),t.getDate()),c=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1});if(i.getTime()===o.getTime())return c;if(i.getTime()===s.getTime())return`Yesterday | ${c}`;return`${String(t.getDate()).padStart(2,"0")} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]}. ${t.getFullYear()} | ${c}`}(o.timestamp)} ]`;const a=document.createElement("div");a.className="message-content";const r=document.createElement("div");r.className="message-author";let l=o.nickname;o.from_discord&&(l+=" [dc]");l+=" : ",r.textContent=l;const m=document.createElement("div");m.className="message-text",m.textContent=o.content,a.appendChild(r),a.appendChild(m),i.appendChild(c),i.appendChild(a),s.appendChild(i),s.scrollTop=s.scrollHeight,h.isInitialLoad||function(){if(t&&n)try{e||(e=new(window.AudioContext||window.webkitAudioContext));const t=e.createOscillator(),n=e.createGain();t.connect(n),n.connect(e.destination),t.frequency.setValueAtTime(800,e.currentTime),t.frequency.exponentialRampToValueAtTime(600,e.currentTime+.1),n.gain.setValueAtTime(.3,e.currentTime),n.gain.exponentialRampToValueAtTime(.01,e.currentTime+.2),t.start(e.currentTime),t.stop(e.currentTime+.2)}catch(e){console.error("Failed to play sound:",e)}}()}(i):"system"===i.type&&"connected to hangout"===i.message?setTimeout((()=>{this.isInitialLoad=!1}),100):"error"===i.type?m(i.message):"online_count"===i.type&&r&&(r.textContent=`(${i.count} online)`)}catch(e){}}onClose(e){this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=null),this.stopHeartbeat(),this.isIntentionallyClosed||this.handleReconnect()}handleReconnect(){if(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.reconnectAttempts>=this.maxReconnectAttempts)return void m("Connection lost. Please refresh the page.");this.reconnectAttempts++;const e=Math.min(this.reconnectDelay*Math.pow(1.5,this.reconnectAttempts-1),this.maxReconnectDelay);m(`Reconnecting... (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.reconnectTimeout=setTimeout((()=>{this.connect()}),e)}startHeartbeat(){this.stopHeartbeat(),this.heartbeatInterval=setInterval((()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN)try{this.ws.send(JSON.stringify({type:"heartbeat"}))}catch(e){}}),25e3)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}send(e){if(this.ws&&this.ws.readyState===WebSocket.OPEN)try{return this.ws.send(JSON.stringify(e)),!0}catch(e){return!1}return!1}close(){this.isIntentionallyClosed=!0,this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.connectionTimeout&&clearTimeout(this.connectionTimeout),this.stopHeartbeat(),this.ws&&this.ws.close()}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}};function m(e){if(Array.from(l.children).find((t=>t.textContent===e)))return;l.innerHTML="";const t=document.createElement("div");t.className="chat-error-message",t.textContent=e,t.style.fontSize="16px",t.style.color="var(--color-secondary)",l.style.display="block",l.appendChild(t),e.toLowerCase().includes("reconnect")||setTimeout((()=>{t.remove(),0===l.children.length&&(l.style.display="none")}),3e3)}function d(){const e=i.value.trim();if(!e)return;if(!h.isConnected())return void m("Not connected. Hold on...");const t=c.value.trim()||"anonymous";h.send({type:"message",nickname:t,content:e})?i.value="":m("Failed to send message.")}h.connect(),a.addEventListener("click",d),i.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),d())})),document.addEventListener("visibilitychange",(()=>{document.hidden||h.isConnected()||h.isIntentionallyClosed||h.handleReconnect()})),window.addEventListener("beforeunload",(()=>h.close())),window.addEventListener("online",(()=>{h.isConnected()||h.handleReconnect()})),window.addEventListener("offline",(()=>{m("Network connection lost")}))}();